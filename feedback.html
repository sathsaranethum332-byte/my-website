<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROLLEX GAMING - Live Feedback</title>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background: linear-gradient(-45deg,#0f2027,#240176,#8f00ff,#00f0ff);
background-size:400% 400%;
animation:bgMove 10s ease infinite;
color:white;
text-align:center;
}

@keyframes bgMove{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}

.container{
max-width:650px;
margin:60px auto;
background:rgba(0,0,0,0.7);
padding:30px;
border-radius:20px;
backdrop-filter:blur(15px);
box-shadow:0 0 40px #00f0ff;
}

input, textarea{
width:100%;
padding:12px;
margin:10px 0;
border:none;
border-radius:10px;
background:#111;
color:white;
box-shadow:0 0 10px #8f00ff inset;
}

button{
padding:10px 15px;
border:none;
border-radius:10px;
cursor:pointer;
margin:5px 5px 5px 0;
font-weight:bold;
background:linear-gradient(45deg,#00f0ff,#8f00ff);
color:white;
}

button:hover{
transform:scale(1.05);
box-shadow:0 0 15px #00f0ff;
}

.feedback{
background:#111;
padding:15px;
border-radius:12px;
margin:15px 0;
box-shadow:0 0 20px #00f0ff;
position:relative;
text-align:left;
}

.delete-btn{
background:red;
}

.reply-area{
margin-top:10px;
}

.reply-box{
margin-top:10px;
padding:10px;
background:#1a1a1a;
border-radius:8px;
color:#00f0ff;
box-shadow:0 0 10px #00f0ff;
}

#adminPanel{
display:none;
}
</style>
</head>
<body>

<div class="container">

<h2 style="color:#00f0ff;">ðŸŽ® LIVE GAMING FEEDBACK</h2>

<div id="adminPanel">
<h3>Admin Login</h3>
<input type="email" id="adminEmail" placeholder="Admin Email">
<input type="password" id="adminPass" placeholder="Admin Password">
<button onclick="adminLogin()">Login</button>
<hr>
</div>

<input type="text" id="name" placeholder="Your Name">
<textarea id="message" placeholder="Your Feedback"></textarea>
<button onclick="addFeedback()">Submit Feedback</button>
<br>
<a href="index.html"><button>â¬… Back</button></a>

<div id="feedbackList"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBuM8CLvGn_e2nn7KNv8BK5XaCU9qoDi5U",
  authDomain: "feedback-dae72.firebaseapp.com",
  databaseURL: "https://feedback-dae72-default-rtdb.firebaseio.com",
  projectId: "feedback-dae72",
  storageBucket: "feedback-dae72.firebasestorage.app",
  messagingSenderId: "1090089969045",
  appId: "1:1090089969045:web:0d8cca44747605026fc29c"
};

const ADMIN_EMAIL = "nethumsathsara100@gmail.com";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

let currentUser = null;

/* LOGIN STATE */
onAuthStateChanged(auth,(user)=>{
currentUser = user;

if(user && user.email === ADMIN_EMAIL){
document.getElementById("adminPanel").style.display="block";
}

loadFeedback();
});

/* ADMIN LOGIN */
window.adminLogin = function(){
const email = document.getElementById("adminEmail").value;
const pass = document.getElementById("adminPass").value;

signInWithEmailAndPassword(auth,email,pass)
.then(()=>alert("Admin Login Success"))
.catch(err=>alert(err.message));
}

/* ADD FEEDBACK */
window.addFeedback = function(){
const name = document.getElementById("name").value.trim();
const message = document.getElementById("message").value.trim();

if(!name || !message){
alert("Fill all fields");
return;
}

push(ref(db,"feedbacks"),{
name:name,
message:message,
time:Date.now()
});

document.getElementById("name").value="";
document.getElementById("message").value="";
}

/* LOAD FEEDBACK */
function loadFeedback(){

const feedbackRef = ref(db,"feedbacks");

onValue(feedbackRef,(snapshot)=>{

const data = snapshot.val();
const list = document.getElementById("feedbackList");
list.innerHTML="";

if(data){

Object.entries(data)
.sort((a,b)=>b[1].time - a[1].time)
.forEach(([key,f])=>{

const card = document.createElement("div");
card.className="feedback";

const name = document.createElement("strong");
name.innerText = f.name;

const msg = document.createElement("p");
msg.innerText = f.message;

card.appendChild(name);
card.appendChild(msg);

/* SHOW REPLY TO EVERYONE */
if(f.reply){
const replyBox = document.createElement("div");
replyBox.className="reply-box";
replyBox.innerHTML="<strong>Admin Reply:</strong><br>"+f.reply;
card.appendChild(replyBox);
}

/* ADMIN BUTTONS */
if(currentUser && currentUser.email===ADMIN_EMAIL){

const replyBtn = document.createElement("button");
replyBtn.innerText="Reply";
replyBtn.onclick=()=>showReplyArea(key);

const deleteBtn = document.createElement("button");
deleteBtn.className="delete-btn";
deleteBtn.innerText="Delete";
deleteBtn.onclick=()=>deleteFeedback(key);

card.appendChild(replyBtn);
card.appendChild(deleteBtn);
}

const replyArea = document.createElement("div");
replyArea.className="reply-area";
replyArea.id="replyArea-"+key;
card.appendChild(replyArea);

list.appendChild(card);

});
}

});

}

/* DELETE (ADMIN ONLY) */
function deleteFeedback(key){
if(currentUser && currentUser.email===ADMIN_EMAIL){
remove(ref(db,"feedbacks/"+key));
}
}

/* SHOW REPLY AREA */
function showReplyArea(key){
const area = document.getElementById("replyArea-"+key);

area.innerHTML=`
<textarea id="replyInput-${key}" placeholder="Write reply..."></textarea>
<button onclick="sendReply('${key}')">Send</button>
`;
}

/* SEND REPLY */
window.sendReply = function(key){

if(!(currentUser && currentUser.email===ADMIN_EMAIL)){
alert("Admin only");
return;
}

const text = document.getElementById("replyInput-"+key).value.trim();

if(!text){
alert("Write something");
return;
}

update(ref(db,"feedbacks/"+key),{
reply:text
});
}

</script>

</body>
</html>
